<!DOCTYPE html>
<html lang="hi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>GK Gaming & Fun Target - Integrated System</title>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-database.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-auth.js"></script>

    <style>
        /* पेज को पूरी तरह लॉक करने के लिए CSS */
        * {
            -webkit-touch-callout: none;
            -webkit-user-select: none;
            -moz-user-select: none;
            -ms-user-select: none;
            user-select: none;
            -webkit-tap-highlight-color: transparent;
            -webkit-tap-highlight-color: rgba(0, 0, 0, 0);
            touch-action: manipulation;
        }
        
        input, textarea {
            -webkit-user-select: text;
            -moz-user-select: text;
            -ms-user-select: text;
            user-select: text;
        }
        
        body, html {
            overscroll-behavior: none;
            -webkit-overflow-scrolling: touch;
            overflow: hidden;
        }

        :root 
        {
            --neon-green: #39ff14;
            --gold-orange: #ff8c00;
            --pure-white: #ffffff;
            --logout-red: #ff3333;
            --border-wood: #4a2c1d;
            --modal-bg: rgba(0, 0, 0, 0.9);
        }

        * 
        { 
            margin: 0; 
            padding: 0; 
            box-sizing: border-box; 
            font-family: 'Arial Black', sans-serif; 
        }

        body, 
        html 
        { 
            width: 100%; 
            height: 100%; 
            background-color: #000; 
            overflow: hidden; 
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
        }

        #loginSection 
        {
            width: 100vw; 
            height: 100vh;
            background-image: url('https://uploads.onecompiler.io/445tyzay6/44bt975c9/1000068077.jpg');
            background-size: 100% 100%;
            position: fixed; 
            top: 0; 
            left: 0; 
            z-index: 10000; 
            display: flex;
            touch-action: none;
        }

        .response-header 
        { 
            position: absolute; 
            top: 2%; 
            left: 2%; 
            font-size: 1.8vw; 
            font-weight: bold; 
            color: var(--gold-orange); 
            text-shadow: 2px 2px #000; 
        }

        .input-area 
        { 
            position: absolute; 
            top: 77%; 
            left: 30.8%; 
            display: flex; 
            flex-direction: column; 
            gap: 1vw; 
        }

        .gk-input 
        { 
            width: 15vw; 
            height: 2.2vw; 
            background: #fff; 
            border: 2px solid var(--border-wood); 
            color: #000; 
            font-weight: bold; 
            font-size: 1.5vw; 
            padding: 0 10px; 
            outline: none; 
            -webkit-user-select: text;
            -moz-user-select: text;
            -ms-user-select: text;
            user-select: text;
        }

        .btn-enter-visual 
        { 
            position: absolute; 
            bottom: 3.5%; 
            left: 55%; 
            width: 14vw; 
            height: 5.5vw; 
            cursor: pointer; 
            background: linear-gradient(to bottom, #ff8c00, #8b4513); 
            border: 2px solid #ffd700; 
            color: #fff; 
            font-size: 2vw; 
            font-weight: bold; 
            border-radius: 10px; 
            display: flex; 
            justify-content: center; 
            align-items: center; 
            text-shadow: 2px 2px #000; 
            -webkit-tap-highlight-color: rgba(255, 255, 255, 0.3);
        }

        #homeSection 
        {
            width: 100vw; 
            height: 100vh;
            background-image: url('https://uploads.onecompiler.io/445tyzay6/44aa8dkt6/1000061816.jpg');
            background-size: 100% 100%; 
            position: relative; 
            display: none; 
            z-index: 9000;
            touch-action: none;
        }

        .top-nav 
        { 
            position: absolute; 
            top: 1.2%; 
            width: 100%; 
            display: flex; 
            padding: 0 3%; 
            font-size: 1.5vw; 
        }

        .id-label 
        { 
            color: var(--gold-orange); 
        }

        .points-label 
        { 
            color: var(--gold-orange); 
            margin-left: 21%; 
        }

        .dynamic-val 
        { 
            color: var(--pure-white); 
            margin-left: 10px; 
        }

        .game-header 
        { 
            position: absolute; 
            top: 10%; 
            left: 80%; 
            transform: translateX(-50%); 
            color: var(--gold-orange); 
            font-size: 2.5vw; 
            font-weight: bold; 
            text-shadow: 2px 2px #000; 
            text-transform: uppercase; 
        }

        .fun-target-box 
        { 
            position: absolute; 
            top: 21%; 
            left: 75%; 
            color: var(--neon-green); 
            font-size: 2.1vw; 
            font-weight: bold; 
            text-shadow: 2px 2px #000; 
            cursor: pointer; 
            z-index: 9500; 
            -webkit-tap-highlight-color: rgba(57, 255, 20, 0.3);
        }

        .child-reg-container 
        { 
            position: absolute; 
            top: 19.3%; 
            left: 53.9%; 
            transform: translateX(-50%); 
            text-align: center; 
            cursor: pointer; 
        }

        .child-reg-text 
        { 
            color: var(--neon-green); 
            font-size: 1.5vw; 
            font-weight: bold; 
            line-height: 1; 
            text-transform: uppercase; 
            display: flex;
            color: transparent;
            user-select: none;
        }

        .panel-action-bar 
        { 
            position: absolute; 
            top: 63.2%; 
            width: 90%; 
            display: flex; 
            justify-content: space-between; 
            padding: 0 5% 0 10.5%; 
            font-size: 1.1vw; 
        }

        .label-green 
        { 
            color: var(--neon-green); 
            font-style: italic; 
            font-weight: bold; 
        }

        .btn-orange 
        { 
            color: var(--gold-orange); 
            cursor: pointer; 
            font-weight: bold; 
            -webkit-tap-highlight-color: rgba(255, 140, 0, 0.3);
        }

        .footer-links 
        { 
            position: absolute; 
            bottom: 5.1%; 
            width: 90%; 
            display: flex; 
            justify-content: space-between; 
            padding: 0 3%; 
        }

        .refresh-action 
        { 
            color: var(--neon-green); 
            font-size: 1vw; 
            cursor: pointer; 
            font-weight: bold; 
            -webkit-tap-highlight-color: rgba(57, 255, 20, 0.3);
        }

        .logout-action 
        { 
            color: var(--logout-red); 
            font-size: 1.5vw; 
            cursor: pointer; 
            font-weight: bold; 
            -webkit-tap-highlight-color: rgba(255, 51, 51, 0.3);
        }

        #transferModal 
        { 
            display: none; 
            position: fixed; 
            z-index: 50000; 
            left: 0; 
            top: 0; 
            width: 100%; 
            height: 100%; 
            background-color: var(--modal-bg); 
            justify-content: center; 
            align-items: center; 
            touch-action: none;
        }

        .new-modal-box 
        { 
            width: 550px; 
            background: radial-gradient(circle, #8b0000 0%, #2b0000 100%); 
            border: 2px solid #d2691e; 
            padding: 0; 
            color: #fff; 
        }

        .m-header 
        { 
            text-align: center; 
            font-size: 22px; 
            padding: 20px 0; 
            font-weight: bold; 
            letter-spacing: 3px; 
        }

        .m-content 
        { 
            padding: 10px 30px; 
        }

        .m-row 
        { 
            display: flex; 
            align-items: center; 
            margin-bottom: 20px; 
            text-transform: uppercase; 
        }

        .m-label 
        { 
            width: 180px; 
            font-weight: bold; 
        }

        .m-input-field 
        { 
            background: rgba(255, 255, 255, 0.1); 
            border: 1px solid #d2691e; 
            color: #fff; 
            padding: 5px 10px; 
            width: 100%; 
            outline: none; 
            -webkit-user-select: text;
            -moz-user-select: text;
            -ms-user-select: text;
            user-select: text;
        }

        .m-btn-container 
        { 
            display: flex; 
            justify-content: center; 
            gap: 30px; 
            margin: 20px 0 30px 0; 
        }

        .m-btn 
        { 
            background: linear-gradient(to bottom, #7d0000 0%, #3a0000 100%); 
            border: 2px solid #fff; 
            border-radius: 25px; 
            color: white; 
            padding: 8px 30px; 
            font-weight: bold; 
            cursor: pointer; 
            text-transform: uppercase; 
            -webkit-tap-highlight-color: rgba(255, 255, 255, 0.3);
        }

        #gameSection 
        { 
            display: none; 
            width: 100vw; 
            height: 100vh; 
            position: relative; 
            background-color: #000; 
            touch-action: none;
        }

        .deep-background 
        { 
            position: absolute; 
            width: 100vw; 
            height: 90vh; 
            z-index: 19; 
            background: url('https://uploads.onecompiler.io/445tyzay6/44asw3n5n/1000061382.jpg') no-repeat center center; 
            background-size: 100% 100%; 
            pointer-events: none; 
        }

        .game-wrapper 
        { 
            position: relative; 
            width: 100vw; 
            height: 100vh; 
            background: url('https://uploads.onecompiler.io/445tyzay6/44b6uby2z/1000063625.png') no-repeat center center; 
            background-size: 100% 100%; 
            z-index: 100; 
            pointer-events: none; 
        }

        .data-box, 
        .action-setup, 
        .chip-setup, 
        .num-setup, 
        #total-bet-box, 
        #bottom-status-text 
        { 
            pointer-events: auto; 
        }

        .data-box 
        { 
            position: absolute; 
            background: rgba(255, 255, 255, 0.0); 
            border: 0px solid red; 
            color: #000; 
            text-align: center; 
            font-weight: 900; 
            z-index: 110; 
        }

        #score-val 
        { 
            top: 11.5%; 
            left: 4%; 
            width: 15%; 
            height: 5%; 
            font-size: 1.6vw; 
        }

        #timer-val 
        { 
            top: 32%; 
            left: -0.1%; 
            width: 23.6%; 
            height: 9.2%; 
            font-size: 1.6vw; 
            display: flex; 
            align-items: center; 
            justify-content: center; 
            background-size: 100% 100%; 
        }

        #winner-val 
        { 
            top: 11.5%; 
            right: 5%; 
            width: 15%; 
            height: 5%; 
            font-size: 1.6vw; 
        }

        #history-val 
        { 
            top: 34.5%; 
            right: 4%; 
            width: 17%; 
            height: 5%; 
            font-size: 1.1vw; 
            overflow: hidden; 
            white-space: nowrap; 
        }

        #total-bet-box 
        { 
            position: absolute; 
            bottom: 0.5%; 
            left: 5%; 
            transform: translateX(-50%); 
            width: 6%; 
            height: 4%; 
            border: 0px solid #ffd700; 
            color: #000; 
            text-align: center; 
            font-size: 1vw; 
            font-weight: bold; 
            display: flex; 
            align-items: center; 
            justify-content: center; 
            z-index: 150; 
            border-radius: 5px; 
        }

        #bottom-status-text 
        { 
            position: absolute; 
            bottom: 21.2%; 
            left: 92.5%; 
            transform: translateX(-50%); 
            width: 15%; 
            height: 5.5%; 
            color: #fff; 
            font-size: 1.1vw; 
            font-weight: bold; 
            z-index: 150; 
            display: flex; 
            align-items: center; 
            justify-content: center; 
            background-size: 100% 100%; 
            text-shadow: 2px 2px 4px #000; 
            cursor: pointer; 
            -webkit-tap-highlight-color: rgba(255, 255, 255, 0.0);
        }

        .action-setup 
        { 
            position: absolute; 
            cursor: pointer; 
            z-index: 120; 
            display: flex; 
            align-items: center; 
            justify-content: center; 
            font-size: 1.1vw; 
            color: white; 
            font-weight: bold; 
            background-size: 100% 100%; 
            border: none; 
            -webkit-tap-highlight-color: rgba(255, 255, 255, 0.0);
        }

        #take-btn 
        { 
            bottom: 21%; 
            left: 0%; 
            width: 15%; 
            height: 5.5%; 
        }

        #cancel-btn 
        { 
            bottom: 20%; 
            left: 18%; 
            width: 13%; 
            height: 5.5%; 
            background-image: url('https://uploads.onecompiler.io/445tyzay6/44b9p9ez6/1000063327.png'); 
        }

        #cancel-all-bet-btn 
        { 
            bottom: 20%; 
            right: 18%; 
            width: 13%; 
            height: 5.5%; 
            background-image: url('https://uploads.onecompiler.io/445tyzay6/44b9p9ez6/1000063327.png'); 
            font-size: 1vw; 
        }

        #exit-btn 
        { 
            bottom: 0.6%; 
            right: 1%; 
            width: 6%; 
            height: 3.5%; 
            color: #fff; 
            background: rgba(0, 0, 0, 0.0); 
            border: 1px solid red; 
        }

        .chip-setup 
        { 
            position: absolute; 
            width: 4.5%; 
            height: 4%; 
            cursor: pointer; 
            z-index: 130; 
            background: rgba(0, 0, 255, 0.0); 
            border: 0px solid blue; 
            display: flex; 
            align-items: center; 
            justify-content: center; 
            color: blue; 
            font-size: 0vw; 
            font-weight: bold; 
            -webkit-tap-highlight-color: rgba(0, 0, 255, 0.0);
        }

        .num-setup 
        { 
            position: absolute; 
            width: 6.5%; 
            height: 8.9%; 
            cursor: pointer; 
            z-index: 130;
            background-size: 100% 100%; 
            border: 0px solid yellow; 
            -webkit-tap-highlight-color: rgba(255, 255, 0, 0.0);
        }

        .bet-amt 
        { 
            position: absolute; 
            width: 100%; 
            top: -40%; 
            text-align: center; 
            color: #000; 
            font-weight: bold; 
            font-size: 1.2vw; 
            text-shadow: 1px 1px 2px #000; 
        }

        #num-1 
        { 
            bottom: 5.3%; 
            left: 1.9%; 
        }

        #num-2 
        { 
            bottom: 5.3%; 
            left: 11.9%; 
        }

        #num-3 
        { 
            bottom: 5.3%; 
            left: 21.9%; 
        }

        #num-4 
        { 
            bottom: 5.3%; 
            left: 31.9%; 
        }

        #num-5 
        { 
            bottom: 5.3%; 
            left: 41.8%; 
        }

        #num-6 
        { 
            bottom: 5.3%; 
            left: 51.7%; 
        }

        #num-7 
        { 
            bottom: 5.3%; 
            left: 61.7%; 
        }

        #num-8 
        { 
            bottom: 5.3%; 
            left: 71.7%; 
        }

        #num-9 
        { 
            bottom: 5.3%; 
            left: 81.8%; 
        }

        #num-0 
        { 
            bottom: 5.3%; 
            left: 91.7%; 
        }

        .wheel-container 
        { 
            position: absolute; 
            top: 43%; 
            left: 49.2%; 
            transform: translate(-50%, -55%); 
            width: 30%; 
            aspect-ratio: 1/1; 
            z-index: 50; 
            display: flex; 
            align-items: center; 
            justify-content: center; 
        }

        .pointer-container 
        { 
            position: absolute; 
            top: -30px; 
            left: 49.7%; 
            transform: translateX(-50%); 
            width: 60px; 
            height: 60px; 
            z-index: 110; 
        }

        .ball-frame 
        { 
            position: absolute; 
            width: 85px; 
            height: 90px; 
            border-radius: 50%; 
            top: 50%; 
            left: 50.3%; 
            transform: translate(-50%, -51.5%); 
            z-index: 0; 
            background-color: #000; 
        }

        .ning-ball 
        { 
            width: 100%; 
            height: 105%; 
            background-size: contain; 
            background-repeat: no-repeat; 
            background-position: center; 
            background-image: url('https://uploads.onecompiler.io/445tyzay6/449rx2mty/1000060967.jpg'); 
        }

        #wheel-img 
        { 
            width: 100%; 
            height: 100%; 
            transform: rotate(0deg); 
            transition: transform 10s cubic-bezier(0.15, 0, 0.2, 1); 
        }

        /* NEW: Pointer overlay styles */
        .pointer-overlay { 
            position: absolute; 
            top: -30px; 
            left: 50.2%; 
            transform: translateX(-50%); 
            width: 63px; 
            height: 63px; 
            background-image: url('https://uploads.onecompiler.io/445tyzay6/449ttb5ur/1000061114.png'); 
            background-size: contain; 
            background-repeat: no-repeat;
            z-index: 150; 
        }

        .pointer-overlay.jiggle { 
            animation: blink-pointer 0.50s steps(2) infinite; 
        }

        @keyframes blink-pointer { 
            0%, 100% { 
                opacity: 1; 
            } 
            50% { 
                opacity: 0; 
            } 
        }

        @keyframes timer-bg-anim 
        { 
            0%, 100% 
            { 
                background-image: url('https://uploads.onecompiler.io/445tyzay6/44b9g36nh/1000063774.png'); 
            } 
            50% 
            { 
                background-image: none; 
            } 
        }

        .timer-bg-blink 
        { 
            animation: timer-bg-anim 0.4s step-end infinite; 
        }

        @keyframes image-only-blink 
        { 
            0%, 100% 
            { 
                background-image: var(--bg-img); 
                opacity: 1; 
            } 
            50% 
            { 
                background-image: none; 
            } 
        }

        .blink-bg 
        { 
            animation: image-only-blink 0.4s step-end infinite; 
        }

        @keyframes bet-blink-anim 
        { 
            0%, 100% 
            { 
                background-image: url('https://uploads.onecompiler.io/445tyzay6/44baxzbt9/1000063333.jpg'); 
            } 
            50% 
            { 
                background-image: none; 
            } 
        }

        .bet-ok-blink 
        { 
            animation: bet-blink-anim 0.4s step-end infinite; 
        }

        @keyframes take-blink-anim 
        { 
            0%, 100% 
            { 
                background-image: url('https://uploads.onecompiler.io/445tyzay6/44bb8xqdr/1000063336.jpg'); 
            } 
            50% 
            { 
                background-image: none; 
            } 
        }

        .take-active-blink 
        { 
            animation: take-blink-anim 0.4s step-end infinite; 
        }

        @keyframes overlay-blink-anim 
        { 
            0%, 100% 
            { 
                background-image: url('https://uploads.onecompiler.io/445tyzay6/44bb8xqdr/1000063325.png'); 
            } 
            50% 
            { 
                background-image: none; 
            } 
        }

        .cancel-overlay-blink::after 
        { 
            content: ''; 
            position: absolute; 
            top:0; 
            left:0; 
            width:100%; 
            height:100%; 
            background-size:100% 100%; 
            pointer-events:none; 
            z-index:121; 
            animation: overlay-blink-anim 0.4s step-end infinite; 
        }

        .animate-now {
            animation: rotateBall 1.5s steps(1) infinite;
        }

        @keyframes rotateBall {
          0%   { background-image: url('https://uploads.onecompiler.io/445tyzay6/449rx2mty/1000060967.jpg'); }
          5%   { background-image: url('https://uploads.onecompiler.io/445tyzay6/449rx2mty/1000060968.jpg'); }
          10%  { background-image: url('https://uploads.onecompiler.io/445tyzay6/449rx2mty/1000060979.jpg'); }
          15%  { background-image: url('https://uploads.onecompiler.io/445tyzay6/449rxvs4s/1000060980.jpg'); }
          20%  { background-image: url('https://uploads.onecompiler.io/445tyzay6/449rxvs4s/1000060981.jpg'); }
          25%  { background-image: url('https://uploads.onecompiler.io/445tyzay6/449rxvs4s/1000060982.jpg'); }
          30%  { background-image: url('https://uploads.onecompiler.io/445tyzay6/449rxvs4s/1000060983.jpg'); }
          35%  { background-image: url('https://uploads.onecompiler.io/445tyzay6/449rxvs4s/1000060984.jpg'); }
          40%  { background-image: url('https://uploads.onecompiler.io/445tyzay6/449rxvs4s/1000060985.jpg'); }
          45%  { background-image: url('https://uploads.onecompiler.io/445tyzay6/449rxvs4s/1000060986.jpg'); }
          50%  { background-image: url('https://uploads.onecompiler.io/445tyzay6/449rxvs4s/1000060938.jpg'); }
          55%  { background-image: url('https://uploads.onecompiler.io/445tyzay6/449rz476r/1000060970.jpg'); }
          60%  { background-image: url('https://uploads.onecompiler.io/445tyzay6/449rz476r/1000060971.jpg'); }
          65%  { background-image: url('https://uploads.onecompiler.io/445tyzay6/449rzzrfb/1000060941.jpg'); }
          70%  { background-image: url('https://uploads.onecompiler.io/445tyzay6/449rzzrfb/1000060901.jpg'); }
          75%  { background-image: url('https://uploads.onecompiler.io/445tyzay6/449s2ey5g/1000060902.jpg'); }
          80%  { background-image: url('https://uploads.onecompiler.io/445tyzay6/449s2ey5g/1000060944.jpg'); }
          85%  { background-image: url('https://uploads.onecompiler.io/445tyzay6/449s2ey5g/1000060945.jpg'); }
          90%  { background-image: url('https://uploads.onecompiler.io/445tyzay6/449s2ey5g/1000060946.jpg'); }
          95%  { background-image: url('https://uploads.onecompiler.io/445tyzay6/449s2sj5r/1000060947.jpg'); }
          100% { background-image: url('https://uploads.onecompiler.io/445tyzay6/449rx2mty/1000060967.jpg'); }
        }

        #pleaseWaitOverlay 
        {
            display: none;
            position: absolute;
            bottom: 0%;
            left: 25%;
            width: 50%;
            height: 5%;
            background: rgba(0, 0, 0, 0.0);
            z-index: 500;
            color: var(--gold-orange);
            font-size: 1.5vw;
            font-weight: bold;
            justify-content: center;
            align-items: center;
            text-shadow: 2px #000;
            pointer-events: auto; 
            border-radius: 0px;
        }

        /* बटन पर क्लिक होने पर हाईलाइट दिखाने के लिए */
        .click-effect:active {
            transform: scale(0.95);
            opacity: 0.8;
            transition: transform 0.1s, opacity 0.1s;
        }
        
        /* क्लिक रोकने के लिए */
        .no-click {
            pointer-events: none;
        }
        
        /* डबल टैप जूम रोकने के लिए */
        * {
            -ms-content-zooming: none;
            -ms-touch-action: manipulation;
        }

    </style>
</head>
<body oncontextmenu="return false;">

<!-- ऑडियो एलिमेंट्स -->
<audio id="timerAudio" src="reset1_sound.mp3"></audio>
    <source src="https://assets.mixkit.co/active_storage/sfx/286/286-preview.mp3" type="audio/mpeg">
</audio>
<audio id="spinAudio" src="reset2_sound.mp3"></audio>
    <source src="https://assets.mixkit.co/active_storage/sfx/215/215-preview.mp3" type="audio/mpeg">
</audio>
<audio id="buttonAudio" preload="auto">
    <source src="https://assets.mixkit.co/active_storage/sfx/255/255-preview.mp3" type="audio/mpeg">
</audio>
<audio id="betAudio" preload="auto">
    <source src="https://assets.mixkit.co/active_storage/sfx/257/257-preview.mp3" type="audio/mpeg">
</audio>
<audio id="winAudio" preload="auto">
    <source src="https://assets.mixkit.co/active_storage/sfx/201/201-preview.mp3" type="audio/mpeg">
</audio>
<audio id="clickAudio" preload="auto">
    <source src="https://assets.mixkit.co/active_storage/sfx/240/240-preview.mp3" type="audio/mpeg">
</audio>

<div id="loginSection">
    <div class="response-header">Response :- <span id="statusMsg">Please Now Login</span></div>
    <div class="input-area">
        <input type="text" id="uid" class="gk-input" placeholder="GK ID">
        <input type="password" id="pass" class="gk-input" placeholder="Password">
    </div>
    <button class="btn-enter-visual" onclick="login()">ENTER</button>
</div>

<div id="homeSection">
    <div class="top-nav">
        <div class="id-label">LOGGED ID :- <span id="idVal" class="dynamic-val">---</span></div>
        <div class="points-label">POINTS :- <span id="ptsVal" class="dynamic-val">0</span></div>
    </div>
    <div class="game-header">GAME</div>
    <div class="fun-target-box" onclick="launchGame()">FUN TARGET</div>

    <div class="child-reg-container" onclick="openTransferModal()">
        <div class="child-reg-text">POINT<br>TRANSFER</div>
    </div>

    <div class="panel-action-bar">
        <div class="label-green">Receivables</div>
        <div class="btn-orange">RECEIVE</div>
        <div class="btn-orange">REJECT</div>
        <div class="label-green">Transferables</div>
        <div class="btn-orange">REJECT</div>
    </div>
    <div class="footer-links">
        <div class="refresh-action" onclick="location.reload()">REFRESH</div>
        <div class="logout-action" onclick="logout()">LOGOUT</div>
    </div>
</div>

<div id="gameSection">
    <div id="pleaseWaitOverlay">PLEASE WAIT...</div>

    <div class="deep-background"></div>
    <div class="wheel-container">
        <div class="pointer-container">
            <img class="pointer-base" src="https://uploads.onecompiler.io/445tyzay6/449ttb5ur/1000061113.png" style="width:100%">
        </div>
        <!-- NEW: Pointer overlay div -->
        <div class="pointer-overlay" id="pointerOverlay"></div>
        <div class="ball-frame">
            <div id="ning-ball" class="ning-ball"></div>
        </div>
        <img id="wheel-img" src="https://uploads.onecompiler.io/445tyzay6/449ttb5ur/1000061105.png">
    </div>

    <div class="game-wrapper">
        <div id="score-val" class="data-box">0</div>
        <div id="timer-val" class="data-box">--</div>
        <div id="winner-val" class="data-box">?</div>
        <div id="history-val" class="data-box">- - - - - - - - - -</div>
        <div id="total-bet-box">0</div>
        <div id="bottom-status-text" onclick="toggleBetOkBlink()">Prev bet</div>

        <div id="take-btn" class="action-setup" onclick="doTake()">TAKE</div>
        <div id="cancel-btn" class="action-setup" onclick="doCancel()">CANCEL</div>
        <div id="cancel-all-bet-btn" class="action-setup" onclick="doCancel()">CANCEL ALL BET</div>
        <div id="exit-btn" class="action-setup" onclick="backToHome()">EXIT</div>

        <div id="chip-1" class="chip-setup" style="top:48%; left:0.5%;" onclick="selChip(1)">1</div>
        <div id="chip-5" class="chip-setup" style="top:48%; left:6%;" onclick="selChip(5)">5</div>
        <div id="chip-10" class="chip-setup" style="top:48%; left:11.5%;" onclick="selChip(10)">10</div>
        <div id="chip-50" class="chip-setup" style="top:48%; left:17.4%;" onclick="selChip(50)">50</div>
        <div id="chip-100" class="chip-setup" style="top:48%; right:17%;" onclick="selChip(100)">100</div>
        <div id="chip-500" class="chip-setup" style="top:48%; right:11.5%;" onclick="selChip(500)">500</div>
        <div id="chip-1000" class="chip-setup" style="top:48%; right:6%;" onclick="selChip(1000)">1K</div>
        <div id="chip-5000" class="chip-setup" style="top:48%; right:0.5%;" onclick="selChip(5000)">5K</div>

        <div id="num-1" class="num-setup" onclick="place(1)">
            <div id="b-1" class="bet-amt">0</div>
        </div>
        <div id="num-2" class="num-setup" onclick="place(2)">
            <div id="b-2" class="bet-amt">0</div>
        </div>
        <div id="num-3" class="num-setup" onclick="place(3)">
            <div id="b-3" class="bet-amt">0</div>
        </div>
        <div id="num-4" class="num-setup" onclick="place(4)">
            <div id="b-4" class="bet-amt">0</div>
        </div>
        <div id="num-5" class="num-setup" onclick="place(5)">
            <div id="b-5" class="bet-amt">0</div>
        </div>
        <div id="num-6" class="num-setup" onclick="place(6)">
            <div id="b-6" class="bet-amt">0</div>
        </div>
        <div id="num-7" class="num-setup" onclick="place(7)">
            <div id="b-7" class="bet-amt">0</div>
        </div>
        <div id="num-8" class="num-setup" onclick="place(8)">
            <div id="b-8" class="bet-amt">0</div>
        </div>
        <div id="num-9" class="num-setup" onclick="place(9)">
            <div id="b-9" class="bet-amt">0</div>
        </div>
        <div id="num-0" class="num-setup" onclick="place(0)">
            <div id="b-0" class="bet-amt">0</div>
        </div>
    </div>
</div>

<div id="transferModal">
    <div class="new-modal-box">
        <div class="m-header">POINT TRANSFER</div>
        <div class="m-content">
            <div class="m-row">
                <div class="m-label">TO ACCOUNT NO</div>
                <input type="text" id="targetId" class="m-input-field">
            </div>
            <div class="m-row">
                <div class="m-label">PIN</div>
                <input type="password" id="transferPin" class="m-input-field">
            </div>
            <div class="m-row">
                <div class="m-label">AMOUNT</div>
                <input type="number" id="transferAmt" class="m-input-field">
            </div>
        </div>
        <div class="m-btn-container">
            <button class="m-btn" onclick="executeRealTransfer()">TRANSFER</button>
            <button class="m-btn" onclick="closeTransferModal()">CLOSE</button>
        </div>
        <div style="text-align:center; padding-bottom:15px;">RESPONSE: <span id="modalResMsg"></span></div>
    </div>
</div>

<script>
    // पेज को पूरी तरह लॉक करने के लिए JavaScript
    document.addEventListener('DOMContentLoaded', function() {
        // सभी टेक्स्ट सिलेक्शन रोकें
        document.addEventListener('selectstart', function(e) {
            e.preventDefault();
            return false;
        });
        
        // राइट क्लिक रोकें (कॉन्टेक्स्ट मेन्यू)
        document.addEventListener('contextmenu', function(e) {
            e.preventDefault();
            return false;
        });
        
        // ड्रैग स्टार्ट रोकें
        document.addEventListener('dragstart', function(e) {
            e.preventDefault();
            return false;
        });
        
        // कॉपी इवेंट रोकें
        document.addEventListener('copy', function(e) {
            e.preventDefault();
            return false;
        });
        
        // कट इवेंट रोकें
        document.addEventListener('cut', function(e) {
            e.preventDefault();
            return false;
        });
        
        // पेस्ट इवेंट रोकें
        document.addEventListener('paste', function(e) {
            e.preventDefault();
            return false;
        });
        
        // डबल क्लिक रोकें (टेक्स्ट सिलेक्शन के लिए)
        document.addEventListener('dblclick', function(e) {
            e.preventDefault();
            return false;
        });
        
        // कीबोर्ड शॉर्टकट रोकें (Ctrl+C, Ctrl+V, आदि)
        document.addEventListener('keydown', function(e) {
            // Ctrl+C, Ctrl+X, Ctrl+V रोकें
            if (e.ctrlKey && (e.key === 'c' || e.key === 'C' || e.key === 'x' || e.key === 'X' || e.key === 'v' || e.key === 'V')) {
                e.preventDefault();
                return false;
            }
            
            // F12 (डेवलपर टूल्स) रोकें
            if (e.key === 'F12') {
                e.preventDefault();
                return false;
            }
            
            // Ctrl+U (सोर्स कोड देखना) रोकें
            if (e.ctrlKey && e.key === 'u') {
                e.preventDefault();
                return false;
            }
        });
        
        // बाउंड्री और हाईलाइट दिखाने के लिए
        document.addEventListener('touchstart', function(e) {
            var target = e.target;
            if (target.classList.contains('btn-enter-visual') || 
                target.classList.contains('fun-target-box') || 
                target.classList.contains('child-reg-container') ||
                target.classList.contains('btn-orange') ||
                target.classList.contains('refresh-action') ||
                target.classList.contains('logout-action') ||
                target.classList.contains('m-btn') ||
                target.classList.contains('action-setup') ||
                target.classList.contains('chip-setup') ||
                target.classList.contains('num-setup') ||
                target.id === 'bottom-status-text') {
                
                target.classList.add('click-effect');
                setTimeout(function() {
                    target.classList.remove('click-effect');
                }, 150);
            }
        }, {passive: true});
        
        document.addEventListener('mousedown', function(e) {
            var target = e.target;
            if (target.classList.contains('btn-enter-visual') || 
                target.classList.contains('fun-target-box') || 
                target.classList.contains('child-reg-container') ||
                target.classList.contains('btn-orange') ||
                target.classList.contains('refresh-action') ||
                target.classList.contains('logout-action') ||
                target.classList.contains('m-btn') ||
                target.classList.contains('action-setup') ||
                target.classList.contains('chip-setup') ||
                target.classList.contains('num-setup') ||
                target.id === 'bottom-status-text') {
                
                target.classList.add('click-effect');
                setTimeout(function() {
                    target.classList.remove('click-effect');
                }, 150);
            }
        });
    });

    // ऑडियो रेफरेन्सेस
    const timerAudio = document.getElementById('timerAudio');
    const spinAudio = document.getElementById('spinAudio');
    const buttonAudio = document.getElementById('buttonAudio');
    const betAudio = document.getElementById('betAudio');
    const winAudio = document.getElementById('winAudio');
    const clickAudio = document.getElementById('clickAudio');

    // ऑडियो कंट्रोल वेरिएबल
    let isGameActive = false;
    let isPageVisible = true;
    let timerAudioInterval = null;

    // NEW: Pointer overlay reference
    const pointerOverlay = document.getElementById('pointerOverlay');

    // ऑडियो प्ले करने के लिए फंक्शन (गेम एक्टिव होने पर ही)
    function playAudio(audioElement) {
        if (!isGameActive || !isPageVisible) return;
        audioElement.currentTime = 0;
        audioElement.play().catch(e => console.log("Audio play failed:", e));
    }

    // सभी ऑडियो को बंद करने का फंक्शन
    function stopAllAudio() {
        timerAudio.pause();
        timerAudio.currentTime = 0;
        spinAudio.pause();
        spinAudio.currentTime = 0;
        buttonAudio.pause();
        buttonAudio.currentTime = 0;
        betAudio.pause();
        betAudio.currentTime = 0;
        winAudio.pause();
        winAudio.currentTime = 0;
        clickAudio.pause();
        clickAudio.currentTime = 0;
        
        // टाइमर इंटरवल क्लियर करें
        if (timerAudioInterval) {
            clearInterval(timerAudioInterval);
            timerAudioInterval = null;
        }
    }

    // पेज विजिबिलिटी डिटेक्ट करें
    document.addEventListener('visibilitychange', function() {
        if (document.hidden) {
            // पेज मिनिमाइज हुआ है
            isPageVisible = false;
            stopAllAudio();
        } else {
            // पेज वापस आया है
            isPageVisible = true;
        }
    });

    const firebaseConfig = 
    {
        apiKey: "AIzaSyConir_wAwdSI7BsQj-vJsL3496CRb64To",
        databaseURL: "https://funtarget-c2bf0-default-rtdb.firebaseio.com",
        projectId: "funtarget-c2bf0"
    };

    firebase.initializeApp(firebaseConfig);
    const db = firebase.database();

    let myId = "";
    let balance = 0;
    let selectedChip = 10;
    let currentRotation = 0;
    let bets = 
    {
        0:0,
        1:0,
        2:0,
        3:0,
        4:0,
        5:0,
        6:0,
        7:0,
        8:0,
        9:0
    };
    let history = [];
    let pendingWin = 0;
    let currentWinnerNum = -1;
    let currentStatus = "BETTING";
    let currentTime = 60;
    let resultShownForRound = -1;

    // NEW: ऑटोमेटिक बॉल सिस्टम वेरिएबल्स
    let ballImages = [];
    let isAutoBallSystemReady = false;

    // NEW: Pattern variables for win/loss cycle
    let patternStage = "WIN"; // "WIN" or "LOSS"
    let winCounter = 0;
    let lossCounter = 0;
    let currentLossSequence = 0;
    
    // NEW: Loss sequence pattern (हार के बाद कितने हार चाहिए)
    const lossSequence = [3, 5, 6, 4, 8, 3, 9, 10, 1, 15, 20, 5, 2, 11, 5, 21, 10, 22, 50, 5, 10, 20, 5, 10];
    let lossSequenceIndex = 0;

    const numberDegrees = 
    { 
        0:0, 
        1:36, 
        2:72, 
        3:108, 
        4:144, 
        5:180, 
        6:216, 
        7:252, 
        8:288, 
        9:324 
    };

    const numImgs = 
    {
        1:'https://uploads.onecompiler.io/445tyzay6/44b85sf8x/1000063312.jpg',
        2:'https://uploads.onecompiler.io/445tyzay6/44b85sf8x/1000063313.jpg',
        3:'https://uploads.onecompiler.io/445tyzay6/44b85sf8x/1000063314.jpg',
        4:'https://uploads.onecompiler.io/445tyzay6/44b85sf8x/1000063315.jpg',
        5:'https://uploads.onecompiler.io/445tyzay6/44b85sf8x/1000063316.jpg',
        6:'https://uploads.onecompiler.io/445tyzay6/44b85sf8x/1000063317.jpg',
        7:'https://uploads.onecompiler.io/445tyzay6/44b85sf8x/1000063318.jpg',
        8:'https://uploads.onecompiler.io/445tyzay6/44b85sf8x/1000063319.jpg',
        9:'https://uploads.onecompiler.io/445tyzay6/44b869wde/1000063320.jpg',
        0:'https://uploads.onecompiler.io/445tyzay6/44b869wde/1000063311.jpg'
    };

    const sUI = document.getElementById('score-val');
    const tUI = document.getElementById('timer-val');
    const hUI = document.getElementById('history-val');
    const winUI = document.getElementById('winner-val');
    const takeBtn = document.getElementById('take-btn');
    const statusText = document.getElementById('bottom-status-text');
    const totalBetDisplay = document.getElementById('total-bet-box');
    const w = document.getElementById('wheel-img');
    const ball = document.getElementById('ning-ball');
    const cancelBtn = document.getElementById('cancel-btn');
    const cancelAllBtn = document.getElementById('cancel-all-bet-btn');
    const waitOverlay = document.getElementById('pleaseWaitOverlay');

    // NEW: Generate unique session ID for this device
    const sessionId = 'session_' + Date.now() + '_' + Math.random().toString(36).substr(2, 9);

    // NEW: ऑटोमेटिक बॉल सिस्टम इनिशियलाइजेशन
    function initializeAutoBallSystem() {
        console.log("Initializing auto ball system...");
        
        // 1. पहले ballImages लोड करें
        db.ref("game/ballImages").once("value").then((snap) => {
            if (snap.exists()) {
                const data = snap.val();
                ballImages = [];
                
                // सभी एक्टिव बॉल इमेजेस क्रम से लोड करें
                Object.keys(data).sort().forEach((key) => {
                    const imgData = data[key];
                    if (imgData.active === true && imgData.url) {
                        ballImages.push({
                            id: key,
                            url: imgData.url,
                            createdAt: imgData.createdAt || 0
                        });
                        console.log(`Loaded ball image: ${key} - ${imgData.url}`);
                    }
                });
                
                console.log(`Total active ball images: ${ballImages.length}`);
                
                if (ballImages.length === 0) {
                    console.error("No active ball images found in Firebase!");
                    // डिफ़ॉल्ट बॉल इमेजेस ऑटो क्रिएट करें
                    createDefaultBallImages();
                    return;
                }
                
                // 2. currentBall चेक करें, अगर नहीं है तो ऑटो क्रिएट करें
                db.ref("game/currentBall").once("value").then((currentBallSnap) => {
                    if (!currentBallSnap.exists()) {
                        console.log("No currentBall found, creating automatically...");
                        // पहली बॉल सेट करें
                        const firstBall = ballImages[0];
                        db.ref("game/currentBall").set({
                            url: firstBall.url,
                            ballId: firstBall.id,
                            updatedAt: Date.now(),
                            round: 1
                        }).then(() => {
                            console.log(`Auto-created currentBall: ${firstBall.url}`);
                            isAutoBallSystemReady = true;
                            
                            // बॉल इमेज सेट करें
                            ball.style.backgroundImage = `url('${firstBall.url}')`;
                            
                            // ऑटो रोटेशन सिस्टम शुरू करें
                            startAutoBallRotation();
                        });
                    } else {
                        // currentBall पहले से है, उसे लोड करें
                        const currentBallData = currentBallSnap.val();
                        console.log(`Current ball loaded: ${currentBallData.url}`);
                        isAutoBallSystemReady = true;
                        
                        // बॉल इमेज सेट करें
                        if (currentBallData.url) {
                            ball.style.backgroundImage = `url('${currentBallData.url}')`;
                        }
                        
                        // ऑटो रोटेशन सिस्टम शुरू करें
                        startAutoBallRotation();
                    }
                });
                
            } else {
                console.log("No ballImages found, creating default...");
                createDefaultBallImages();
            }
        }).catch((error) => {
            console.error("Error loading ball images:", error);
        });
    }

    // NEW: डिफ़ॉल्ट बॉल इमेजेस ऑटो क्रिएट करें
    function createDefaultBallImages() {
        const defaultBalls = [
            {id: 'img_1', url: 'https://uploads.onecompiler.io/445tyzay6/449rx2mty/1000060967.jpg'},
            {id: 'img_2', url: 'https://uploads.onecompiler.io/445tyzay6/449rx2mty/1000060968.jpg'},
            {id: 'img_3', url: 'https://uploads.onecompiler.io/445tyzay6/449rx2mty/1000060979.jpg'}
        ];
        
        const updates = {};
        defaultBalls.forEach((ball, index) => {
            updates[`game/ballImages/${ball.id}`] = {
                url: ball.url,
                active: true,
                createdAt: Date.now() + index,
                order: index
            };
        });
        
        db.ref().update(updates).then(() => {
            console.log("Default ball images created in Firebase");
            ballImages = defaultBalls;
            
            // currentBall सेट करें
            const firstBall = ballImages[0];
            db.ref("game/currentBall").set({
                url: firstBall.url,
                ballId: firstBall.id,
                updatedAt: Date.now(),
                round: 1
            }).then(() => {
                console.log(`Auto-created currentBall: ${firstBall.url}`);
                isAutoBallSystemReady = true;
                
                // बॉल इमेज सेट करें
                ball.style.backgroundImage = `url('${firstBall.url}')`;
                
                // ऑटो रोटेशन सिस्टम शुरू करें
                startAutoBallRotation();
            });
        });
    }

    // NEW: ऑटो बॉल रोटेशन सिस्टम शुरू करें
    function startAutoBallRotation() {
        // फायरबेस से currentBall के अपडेट सुनें
        db.ref("game/currentBall").on("value", (snap) => {
            if (snap.exists() && isAutoBallSystemReady) {
                const ballData = snap.val();
                if (ballData && ballData.url) {
                    // सभी डिवाइस पर एक ही बॉल इमेज दिखाएं
                    ball.style.backgroundImage = `url('${ballData.url}')`;
                    console.log(`Ball image updated: ${ballData.url}`);
                }
            }
        });
        
        // गेम राउंड कम्पलीट होने पर बॉल बदलने के लिए लिसन करें
        db.ref("game").on("value", (snap) => {
            if (snap.exists() && isAutoBallSystemReady) {
                const gameData = snap.val();
                
                // जब नया राउंड शुरू हो (BETTING status और टाइमर 60)
                if (gameData.status === "BETTING" && gameData.time === 60) {
                    // पिछले राउंड का रिजल्ट आने के बाद नई बॉल सेट करें
                    setTimeout(() => {
                        rotateToNextBall();
                    }, 3000); // 3 सेकंड डिले (रिजल्ट दिखाने के बाद)
                }
            }
        });
    }

    // NEW: अगली बॉल पर रोटेट करें
    function rotateToNextBall() {
        if (ballImages.length === 0) {
            console.error("No ball images available to rotate");
            return;
        }
        
        // currentBall डेटा लोड करें
        db.ref("game/currentBall").once("value").then((snap) => {
            if (snap.exists()) {
                const currentBallData = snap.val();
                let currentBallIndex = -1;
                
                // करंट बॉल का इंडेक्स ढूंढें
                for (let i = 0; i < ballImages.length; i++) {
                    if (ballImages[i].id === currentBallData.ballId) {
                        currentBallIndex = i;
                        break;
                    }
                }
                
                // अगली बॉल का इंडेक्स कैलकुलेट करें
                let nextBallIndex;
                if (currentBallIndex === -1 || currentBallIndex >= ballImages.length - 1) {
                    nextBallIndex = 0; // पहली बॉल पर वापस
                } else {
                    nextBallIndex = currentBallIndex + 1;
                }
                
                const nextBall = ballImages[nextBallIndex];
                
                // फायरबेस में currentBall अपडेट करें
                db.ref("game/currentBall").update({
                    url: nextBall.url,
                    ballId: nextBall.id,
                    updatedAt: Date.now(),
                    round: (currentBallData.round || 0) + 1
                }).then(() => {
                    console.log(`Rotated to next ball: ${nextBall.url}`);
                    
                    // सभी डिवाइस ऑटो अपडेट हो जाएंगे क्योंकि वे currentBall सुन रहे हैं
                });
            }
        });
    }

    // NEW: Function to start pointer blink animation
    function startPointerBlink() {
        if (pointerOverlay) {
            pointerOverlay.classList.add('jiggle');
        }
    }

    // NEW: Function to stop pointer blink animation
    function stopPointerBlink() {
        if (pointerOverlay) {
            pointerOverlay.classList.remove('jiggle');
        }
    }

    // NEW: Function to get numbers with minimum bet (सबसे कम पैसा लगा है वह नंबर)
    function getNumbersWithMinBet() {
        const betsArray = Object.entries(bets);
        const numbersWithBets = betsArray.filter(([num, bet]) => bet > 0);
        
        if (numbersWithBets.length === 0) return [];
        
        // Find minimum bet amount
        const minBet = Math.min(...numbersWithBets.map(([num, bet]) => bet));
        
        // Return all numbers with minimum bet
        return numbersWithBets
            .filter(([num, bet]) => bet === minBet)
            .map(([num, bet]) => parseInt(num));
    }

    // NEW: Function to get numbers without any bet (बिल्कुल ही पैसा नहीं लगा है वह नंबर)
    function getNumbersWithoutAnyBet() {
        return Object.entries(bets)
            .filter(([num, bet]) => bet === 0)
            .map(([num, bet]) => parseInt(num));
    }

    // NEW: Function to get winning number for WIN stage (जीत के लिए - सबसे कम पैसा लगा है वह नंबर)
    function getWinningNumberForWin() {
        const numbersWithMinBet = getNumbersWithMinBet();
        
        if (numbersWithMinBet.length > 0) {
            // सबसे कम पैसा लगा है वह नंबर चुनें
            return numbersWithMinBet[Math.floor(Math.random() * numbersWithMinBet.length)];
        } else {
            // कोई भी पैसा नहीं लगा है तो रैंडम नंबर
            return Math.floor(Math.random() * 10);
        }
    }

    // NEW: Function to get winning number for LOSS stage (हार के लिए - बिल्कुल ही पैसा नहीं लगा है वह नंबर)
    function getWinningNumberForLoss() {
        const numbersWithoutAnyBet = getNumbersWithoutAnyBet();
        
        if (numbersWithoutAnyBet.length > 0) {
            // बिल्कुल ही पैसा नहीं लगा है वह नंबर चुनें
            return numbersWithoutAnyBet[Math.floor(Math.random() * numbersWithoutAnyBet.length)];
        } else {
            // सभी नंबरों पर पैसा लगा है तो सबसे कम पैसे वाला चुनें (फॉलबैक)
            const numbersWithMinBet = getNumbersWithMinBet();
            if (numbersWithMinBet.length > 0) {
                return numbersWithMinBet[Math.floor(Math.random() * numbersWithMinBet.length)];
            } else {
                return Math.floor(Math.random() * 10);
            }
        }
    }

    // NEW: Function to update pattern after each round
    function updatePattern(winningNumber) {
        const numbersWithMinBet = getNumbersWithMinBet();
        const numbersWithBets = Object.entries(bets)
            .filter(([num, bet]) => bet > 0)
            .map(([num, bet]) => parseInt(num));
        
        const isUserWin = numbersWithBets.includes(winningNumber);
        
        console.log(`Pattern: ${patternStage}, Winning Number: ${winningNumber}, User Win: ${isUserWin}`);
        console.log(`Numbers with bets: ${numbersWithBets}, Numbers with min bet: ${numbersWithMinBet}`);
        
        if (patternStage === "WIN") {
            winCounter++;
            
            // 1 win complete, switch to LOSS
            if (winCounter >= 1) {
                patternStage = "LOSS";
                winCounter = 0;
                lossCounter = 0;
                currentLossSequence = lossSequence[lossSequenceIndex];
                lossSequenceIndex = (lossSequenceIndex + 1) % lossSequence.length;
                
                console.log(`Switching to LOSS stage, need ${currentLossSequence} losses`);
            }
        } else if (patternStage === "LOSS") {
            lossCounter++;
            
            // Check if loss sequence complete
            if (lossCounter >= currentLossSequence) {
                patternStage = "WIN";
                winCounter = 0;
                lossCounter = 0;
                console.log(`Switching to WIN stage after ${currentLossSequence} losses`);
            }
        }
        
        console.log(`Current pattern: ${patternStage}, Win Counter: ${winCounter}, Loss Counter: ${lossCounter}/${currentLossSequence}`);
    }

    // NEW: Function to get winning number based on pattern
    function getWinningNumberByPattern() {
        let winningNumber;
        
        if (patternStage === "WIN") {
            winningNumber = getWinningNumberForWin();
            console.log(`WIN stage: Selected number ${winningNumber} (सबसे कम पैसा लगा है वह नंबर)`);
        } else {
            winningNumber = getWinningNumberForLoss();
            console.log(`LOSS stage: Selected number ${winningNumber} (बिल्कुल ही पैसा नहीं लगा है वह नंबर)`);
        }
        
        return winningNumber;
    }

    async function login() 
    {
        const u = document.getElementById('uid').value.trim();
        const p = document.getElementById('pass').value.trim();
        
        if(!u || !p) return;
        
        // NEW: Show "VERIFY" message during login attempt
        document.getElementById('statusMsg').textContent = "VERIFY...";
        document.getElementById('statusMsg').style.color = "#39ff14";
        
        try {
            const snap = await db.ref("users/" + u).once("value");
            
            if(snap.exists()) 
            {
                const val = snap.val();
                
                // NEW: Check if user is already logged in on another device
                if (val.isLoggedIn === true && val.sessionId !== sessionId) {
                    // Force logout from other device
                    await db.ref("users/" + u).update({
                        isLoggedIn: false,
                        sessionId: null,
                        forceLogout: true
                    });
                    
                    // Small delay to ensure other device gets the update
                    await new Promise(resolve => setTimeout(resolve, 500));
                }
                
                if(val.password === p && val.status === "active") 
                {
                    // NEW: Update user with session info
                    await db.ref("users/" + u).update({
                        isLoggedIn: true,
                        sessionId: sessionId,
                        lastLogin: Date.now(),
                        deviceInfo: navigator.userAgent,
                        forceLogout: false
                    });
                    
                    myId = u;
                    sessionStorage.setItem('gk_session', JSON.stringify({uid: u, sessionId: sessionId}));
                    
                    // NEW: Set up listener to detect logout from other devices
                    setupLoginMonitor(u);
                    
                    activateHome();
                } 
                else 
                { 
                    document.getElementById('statusMsg').textContent = "Login Error: Details mismatch!";
                    document.getElementById('statusMsg').style.color = "#ff3333";
                }
            } 
            else 
            { 
                document.getElementById('statusMsg').textContent = "User not found!";
                document.getElementById('statusMsg').style.color = "#ff3333";
            }
        } catch (error) {
            console.error("Login error:", error);
            document.getElementById('statusMsg').textContent = "Login failed!";
            document.getElementById('statusMsg').style.color = "#ff3333";
        }
    }

    // NEW: Function to monitor login status
    function setupLoginMonitor(userId) {
        db.ref("users/" + userId).on("value", (snap) => {
            if (snap.exists()) {
                const userData = snap.val();
                
                // Check if forceLogout flag is set
                if (userData.forceLogout === true) {
                    forceLogout();
                    return;
                }
                
                // If sessionId doesn't match or user is logged out, force logout
                if (userData.isLoggedIn !== true || userData.sessionId !== sessionId) {
                    forceLogout();
                }
            }
        });
    }

    // NEW: Function to force logout (without alert)
    function forceLogout() {
        // Clear all session data
        sessionStorage.removeItem('gk_session');
        
        // Show login section and hide all others
        document.getElementById('loginSection').style.display = 'flex';
        document.getElementById('homeSection').style.display = 'none';
        document.getElementById('gameSection').style.display = 'none';
        
        // Show logout message in status
        document.getElementById('statusMsg').textContent = "Logged out from another device!";
        document.getElementById('statusMsg').style.color = "#ff3333";
        
        // Reset user ID
        myId = "";
        
        // Stop all audio
        isGameActive = false;
        stopAllAudio();
    }

    function activateHome() 
    {
        // होम पेज पर ऑडियो बंद
        isGameActive = false;
        stopAllAudio();
        
        document.getElementById('loginSection').style.display = 'none';
        document.getElementById('homeSection').style.display = 'block';
        document.getElementById('gameSection').style.display = 'none';
        document.getElementById('idVal').textContent = myId;
        syncFromFirebase();
    }

    function launchGame() 
    {
        // गेम सेक्शन खुलने पर ऑडियो एक्टिवेट
        isGameActive = true;
        
        document.getElementById('homeSection').style.display = 'none';
        document.getElementById('gameSection').style.display = 'block';
        
        // NEW: ऑटो बॉल सिस्टम इनिशियलाइज करें
        initializeAutoBallSystem();
    }

    function backToHome() 
    {
        // गेम सेक्शन से निकलने पर सभी ऑडियो बंद
        isGameActive = false;
        stopAllAudio();
        
        document.getElementById('gameSection').style.display = 'none';
        document.getElementById('homeSection').style.display = 'block';
    }

    async function logout() 
    {
        isGameActive = false;
        stopAllAudio();
        
        // NEW: Update Firebase to mark user as logged out
        if (myId) {
            try {
                await db.ref("users/" + myId).update({
                    isLoggedIn: false,
                    sessionId: null,
                    lastLogout: Date.now(),
                    forceLogout: false
                });
            } catch (error) {
                console.error("Error updating logout status:", error);
            }
        }
        
        sessionStorage.removeItem('gk_session');
        
        // Show login section directly without alert
        document.getElementById('loginSection').style.display = 'flex';
        document.getElementById('homeSection').style.display = 'none';
        document.getElementById('gameSection').style.display = 'none';
        document.getElementById('statusMsg').textContent = "Successfully logged out";
        document.getElementById('statusMsg').style.color = "#39ff14";
        
        myId = "";
    }

    function syncFromFirebase() 
    {
        db.ref("users/" + myId).on("value", (snap) => 
        {
            if(snap.exists()) 
            {
                balance = parseFloat(snap.val().balance || 0);
                pendingWin = parseFloat(snap.val().pendingWin || 0);
                document.getElementById('ptsVal').textContent = balance.toFixed(2);
                sUI.innerText = balance.toFixed(2);
                
                if(pendingWin > 0) 
                {
                    takeBtn.classList.add('take-active-blink');
                    takeBtn.innerText = `TAKE (${pendingWin})`;
                } 
                else 
                {
                    takeBtn.classList.remove('take-active-blink');
                    takeBtn.innerText = "TAKE";
                }
            }
        });
    }

    function updateFirebaseBalance(newBal, newPending) 
    {
        db.ref("users/" + myId).update(
        {
            balance: newBal,
            pendingWin: newPending
        });
    }

    setInterval(() => 
    {
        db.ref("game").transaction((game) => 
        {
            if (!game) return { time: 60, status: "BETTING", round: 1, lastWinner: -1 };
            
            game.time--;
            
            if (game.time <= 0) 
            {
                if (game.status === "BETTING") 
                { 
                    game.status = "WAITING"; 
                    game.time = 1; 
                    
                    // NEW: Get winning number based on pattern
                    const winningNumber = getWinningNumberByPattern();
                    game.lastWinner = winningNumber;
                }
                else if (game.status === "WAITING") 
                { 
                    game.status = "RESULT_HOLD"; 
                    game.time = 1; 
                }
                else 
                { 
                    game.status = "BETTING"; 
                    game.time = 60; 
                    game.round++; 
                }
            }
            
            return game;
        });
    }, 1000);

    db.ref("game").on("value", (snap) => 
    {
        const data = snap.val();
        
        if(!data) return;
        
        currentTime = data.time;
        currentStatus = data.status;
        tUI.innerText = `0:${currentTime < 10 ? '0'+currentTime : currentTime}`;

        // टाइमर ऑडियो - केवल गेम एक्टिव होने पर
        if (isGameActive && currentTime <= 60 && currentTime > 10 && currentStatus === "BETTING") {
            playAudio(timerAudio);
        }

        if (currentStatus === "WAITING" || currentStatus === "RESULT_HOLD") 
        {
            waitOverlay.style.display = 'flex';
        } 
        else if (currentStatus === "BETTING" && currentTime <= 10) 
        {
            waitOverlay.style.display = 'flex';
        } 
        else 
        {
            waitOverlay.style.display = 'none';
        }

        if(currentStatus === "BETTING" && currentTime <= 15) 
        {
            cancelBtn.classList.remove('cancel-overlay-blink');
            cancelAllBtn.classList.remove('cancel-overlay-blink');
        }

        if(currentStatus === "BETTING") 
        {
            if(currentTime <= 15) tUI.classList.add('timer-bg-blink');
            else tUI.classList.remove('timer-bg-blink');
            
            if(currentTime === 10 && resultShownForRound !== data.round) 
            {
                startSpinProcess(data.lastWinner, data.round);
            }
        }

        // NEW: Start pointer blink when timer is low
        if (currentStatus === "BETTING" && currentTime <= 10 && currentTime > 0) {
            startPointerBlink();
        } else {
            stopPointerBlink();
        }
    });

    function startSpinProcess(winNum, roundNum) 
    {
        // स्पिन ऑडियो - केवल गेम एक्टिव होने पर
        if (isGameActive) {
            playAudio(spinAudio);
        }
        
        resultShownForRound = roundNum; 
        ball.classList.add('animate-now');
        const extraSpins = 3600; 
        const targetDegree = 360 - numberDegrees[winNum];
        currentRotation += extraSpins + (targetDegree - (currentRotation % 360));
        w.style.transform = `rotate(${currentRotation}deg)`;
        
        setTimeout(() => showFinalResult(winNum), 10000);
    }

    function showFinalResult(winNum) 
    {
        ball.classList.remove('animate-now');
        currentWinnerNum = winNum;
        winUI.innerText = winNum;
        const winBox = document.getElementById(`num-${winNum}`);
        winBox.style.setProperty('--bg-img', `url(${numImgs[winNum]})`);
        winBox.classList.add('blink-bg');

        history.unshift(winNum);
        
        if(history.length > 10) history.pop();
        
        hUI.innerText = history.join('   ');

        let roundWin = bets[winNum] * 9;
        
        if(roundWin > 0) 
        {
            pendingWin += roundWin;
            updateFirebaseBalance(balance, pendingWin);
            
            // जीतने का ऑडियो - केवल गेम एक्टिव होने पर
            if (isGameActive) {
                playAudio(winAudio);
            }
        }
        
        // NEW: Update pattern after showing result
        updatePattern(winNum);
        
        resetTable();
    }

    function resetTable() 
    {
        for(let i=0; i<=9; i++) 
        {
            if(i !== currentWinnerNum) 
            {
                document.getElementById(`b-${i}`).innerText = '0';
                document.getElementById(`num-${i}`).style.backgroundImage = 'none';
                document.getElementById(`num-${i}`).classList.remove('blink-bg');
            }
        }
        
        bets = 
        {
            0:0,
            1:0,
            2:0,
            3:0,
            4:0,
            5:0,
            6:0,
            7:0,
            8:0,
            9:0
        };
        
        statusText.innerText = "Prev bet";
        statusText.classList.remove('bet-ok-blink');
        cancelBtn.classList.remove('cancel-overlay-blink');
        cancelAllBtn.classList.remove('cancel-overlay-blink');
        updateTotalBet();
    }

    window.place = function(n) 
    {
        if(currentStatus !== "BETTING" || pendingWin > 0 || currentTime <= 10) return;

        if(currentWinnerNum !== -1) 
        {
            document.getElementById(`num-${currentWinnerNum}`).classList.remove('blink-bg');
            document.getElementById(`num-${currentWinnerNum}`).style.backgroundImage = 'none';
            currentWinnerNum = -1;
            winUI.innerText = "?";
        }
        
        if(balance >= selectedChip) 
        {
            balance -= selectedChip;
            bets[n] += selectedChip;
            document.getElementById(`b-${n}`).innerText = bets[n];
            document.getElementById(`num-${n}`).style.backgroundImage = `url(${numImgs[n]})`;
            statusText.innerText = "Bet ok";
            statusText.classList.add('bet-ok-blink');
            
            cancelBtn.classList.add('cancel-overlay-blink');
            cancelAllBtn.classList.add('cancel-overlay-blink');
            
            updateTotalBet();
            updateFirebaseBalance(balance, pendingWin);
            
            // बेट लगाने का ऑडियो - केवल गेम एक्टिव होने पर
            if (isGameActive) {
                playAudio(betAudio);
            }
        }
    };

    window.doTake = function() 
    {
        // टेक बटन के लिए ऑडियो - केवल गेम एक्टिव होने पर
        if (isGameActive) {
            playAudio(buttonAudio);
        }
        
        if(pendingWin > 0) 
        {
            balance += pendingWin;
            pendingWin = 0;
            updateFirebaseBalance(balance, 0);
            
            if(currentWinnerNum !== -1) 
            {
                document.getElementById(`num-${currentWinnerNum}`).classList.remove('blink-blog');
                document.getElementById(`num-${currentWinnerNum}`).style.backgroundImage = 'none';
                currentWinnerNum = -1;
            }
            
            winUI.innerText = "?";
        }
    };

    window.doCancel = function() 
    {
        // कैंसल बटन के लिए ऑडियो - केवल गेम एक्टिव होने पर
        if (isGameActive) {
            playAudio(buttonAudio);
        }
        
        if(currentStatus !== "BETTING" || pendingWin > 0 || currentTime <= 15) return;
        
        let totalOnTable = Object.values(bets).reduce((a,b)=>a+b, 0);
        balance += totalOnTable;
        
        bets = 
        {
            0:0,
            1:0,
            2:0,
            3:0,
            4:0,
            5:0,
            6:0,
            7:0,
            8:0,
            9:0
        };
        
        for(let i=0; i<=9; i++) 
        {
            document.getElementById(`b-${i}`).innerText = '0';
            document.getElementById(`num-${i}`).style.backgroundImage = 'none';
        }
        
        cancelBtn.classList.remove('cancel-overlay-blink');
        cancelAllBtn.classList.remove('cancel-overlay-blink');
        statusText.classList.remove('bet-ok-blink');
        statusText.innerText = "Prev bet";
        
        updateTotalBet();
        updateFirebaseBalance(balance, pendingWin);
    };

    window.updateTotalBet = function() 
    {
        let total = Object.values(bets).reduce((a, b) => a + b, 0);
        totalBetDisplay.innerText = total;
    };

    window.selChip = function(v) 
    { 
        // चिप चुनने का ऑडियो - केवल गेम एक्टिव होने पर
        if (isGameActive) {
            playAudio(clickAudio);
        }
        selectedChip = v; 
    };

    function openTransferModal() 
    { 
        // होम पेज पर कोई ऑडियो नहीं
        document.getElementById('transferModal').style.display = 'flex'; 
    }

    function closeTransferModal() 
    { 
        // होम पेज पर कोई ऑडियो नहीं
        document.getElementById('transferModal').style.display = 'none'; 
    }

    async function executeRealTransfer() 
    {
        // होम पेज पर कोई ऑडियो नहीं
        const tId = document.getElementById('targetId').value.trim();
        const amt = parseFloat(document.getElementById('transferAmt').value);
        const pinInput = document.getElementById('transferPin').value;
        const modalRes = document.getElementById('modalResMsg');

        if(!tId || isNaN(amt) || amt <= 0 || !pinInput) 
        { 
            modalRes.textContent = "Details bharen!"; 
            return; 
        }
        
        if(amt > balance) 
        { 
            modalRes.textContent = "Insufficient Balance!"; 
            return; 
        }

        modalRes.textContent = "Processing...";

        try 
        {
            const senderSnap = await db.ref("users/" + myId).once("value");
            
            if(!senderSnap.exists()) 
            { 
                modalRes.textContent = "User Error!"; 
                return; 
            }
            
            const senderData = senderSnap.val();

            if(senderData.pin.toString() !== pinInput.toString()) 
            {
                modalRes.textContent = "Wrong PIN!";
                return;
            }

            const targetSnap = await db.ref("users/" + tId).once("value");
            
            if(!targetSnap.exists()) 
            {
                modalRes.textContent = "Target ID Not Found!";
                return;
            }
            
            const targetData = targetSnap.val();

            const updates = {};
            updates["/users/" + myId + "/balance"] = senderData.balance - amt;
            updates["/users/" + tId + "/balance"] = (targetData.balance || 0) + amt;

            await db.ref().update(updates);

            modalRes.textContent = "Transfer Success!";
            setTimeout(closeTransferModal, 2000);

        } 
        catch (error) 
        {
            console.error(error);
            modalRes.textContent = "Transfer Failed!";
        }
    }

    window.onload = () => 
    {
        const saved = sessionStorage.getItem('gk_session');
        
        if (saved) 
        {
            const sessionData = JSON.parse(saved);
            myId = sessionData.uid;
            
            // NEW: Check if session is still valid
            db.ref("users/" + myId).once("value").then((snap) => {
                if (snap.exists()) {
                    const userData = snap.val();
                    if (userData.isLoggedIn === true && userData.sessionId === sessionData.sessionId) {
                        // Set up login monitor
                        setupLoginMonitor(myId);
                        activateHome();
                    } else {
                        // Session invalid, clear storage
                        sessionStorage.removeItem('gk_session');
                        document.getElementById('statusMsg').textContent = "Session expired. Please login again.";
                        document.getElementById('statusMsg').style.color = "#ff3333";
                    }
                }
            });
        }
    };

</script>
</body>
</html>